---
lang: zh-CN
title: Section 11.6 Analyzing Network Attacks
description: some description
---

As you study this section, answer the following questions:

<ul>
    <li>
     In which type of attack does the hacker place themselves between two devices to intercept communications?
    </li>
    <li>
     Which network layer does an ARP poisoning attack target?
    </li>
    <li>
     What is the usual result of a distributed denial of service attack?
    </li>
    <li>
     Which programming language is commonly used to create remote access Trojans?
    </li>
    <li>
     Which Microsoft programs commonly use macros?
    </li>
</ul>

In this section, you will learn to:

<ul>
    <li>
     Poison ARP and analyze with Wireshark.
    </li>
    <li>
     Poison DNS.
    </li>
    <li>
     Perform and analyze a SYN flood.
    </li>
</ul>

The key terms for this section include:

<table class="terms">
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     Term
    </th>
    <th scope="col" class="fw-bold">
     Definition
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      Man-in-the-middle (MITM) attack
     </td>
     <td>
      An attack in which the hacker intercepts
          communications between two devices.
     </td>
    </tr>
    <tr>
     <td>
      ARP poisoning
     </td>
     <td>
      Attack targeting the ARP protocol. The attacker changes the ARP cache by spoofing the IP address of a target.
     </td>
    </tr>
    <tr>
     <td>
      MAC spoofing
     </td>
     <td>
      Attack in which the hacker spoofs the MAC address of the gateway. This results in the spoofed address overwriting the gateway's MAC address in the switchâ€™s CAM table.
     </td>
    </tr>
    <tr>
     <td>
      MAC flooding
     </td>
     <td>
      Attack against a network switch in which the attacker sends a large number of Ethernet frames with various MAC addresses, overwhelming the switch. The switch is overloaded and sends traffic to all ports.
     </td>
    </tr>
    <tr>
     <td>
      DNS attack
     </td>
     <td>
      An attack that targets DNS services.
     </td>
    </tr>
    <tr>
     <td>
      Distributed denial of service (DDoS)
     </td>
     <td>
      An attack that is designed to bombard the target with more data than it can handle,
          causing it to shut down.
     </td>
    </tr>
    <tr>
     <td>
      Python
     </td>
     <td>
      A easy to read and understand programming language.
     </td>
    </tr>
    <tr>
     <td>
      Command shell
     </td>
     <td>
      A program that provides an interface to give users access to operating system functions and
          services.
     </td>
    </tr>
    <tr>
     <td>
      Macros
     </td>
     <td>
      Code that is used to perform a series of steps or functions inside a specific
          application.
     </td>
    </tr>
   </tbody>
</table>

This section helps you prepare for the following certification exam objectives:

<table class="objectives">
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     Exam
    </th>
    <th scope="col" class="fw-bold">
     Objective
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      TestOut Security Pro
     </td>
     <td>
      5.0 Audit and Security Assessment
      <p>
       5.2 Assessment Techniques
      </p>
      <ul>
       <li>
        Analyze Network Attacks
       </li>
      </ul>
     </td>
    </tr>
    <tr>
     <td>
      CompTIA Security+ SY0-601
     </td>
     <td>
      1.4 Given a scenario, analyze potential indicators associated with network attacks.
      <ul>
       <li>
        Man in the middle
       </li>
       <li>
        Man in the browser
       </li>
       <li>
        Layer 2 attacks
        <ul>
         <li>
          Address resolution protocol (ARP) poisoning
         </li>
         <li>
          Media access control (MAC) flooding
         </li>
         <li>
          MAC cloning
         </li>
        </ul>
       </li>
       <li>
        Domain name system (DNS)
        <ul>
         <li>
          Domain hijacking
         </li>
         <li>
          DNS poisoning
         </li>
         <li>
          Universal resource locator (URL) redirection
         </li>
         <li>
          Domain reputation
         </li>
        </ul>
       </li>
       <li>
        Distributed denial of service (DDoS)
        <ul>
         <li>
          Network
         </li>
         <li>
          Application
         </li>
         <li>
          Operational technology (OT)
         </li>
        </ul>
       </li>
       <li>
        Malicious code or script execution
        <ul>
         <li>
          PowerShell
         </li>
         <li>
          Python
         </li>
         <li>
          Bash
         </li>
         <li>
          Macros
         </li>
         <li>
          Virtual Basic for Applications (VBA)
         </li>
        </ul>
       </li>
      </ul>
      <p>
       4.1 Given a scenario, use the appropriate tool to assess organizational security.
      </p>
      <ul>
       <li>
        Packet capture and replay
        <ul>
         <li>
          Tcpdump
         </li>
        </ul>
       </li>
      </ul>
     </td>
    </tr>
   </tbody>
</table>

## 11.6.1 Analyzing Network Attacks

### Analyze Network Attacks 00:00-00:20

For a network security team to effectively defend their network, they should understand common attacks and how they work. In this lesson, I'll go over some of the more common attacks networks face, such as man-in-the-middle attacks, Layer 2 attacks, DNS attacks, and Distributed Denial of Service attacks.

### Man-In-The-Middle Attacks: 00:20-00:55

A very common threat is the man-in-the-middle attack. In this attack, the hacker places themselves between you and someone you're communicating with in order to intercept your communication. For example, if you send your login information to a website, the hacker can intercept this information and steal your credentials.

Hackers use a variety of methods to perform a man-in-the-middle attack, or MITM attack. These include spoofing IP addresses, spoofing DNS or website names, HTTPS spoofing, SSL hijacking, email hijacking, Wi-Fi eavesdropping, and stealing browser cookies.

### Man-In-The-Browser Attacks 00:55-01:16

A variation on the man-in-the-middle attack is the man-in-the-browser attack. This attack works on the Application layer and inserts a Trojan horse on the victim's computer. This malware exploits the browser itself to manipulate the data and send it to the attacker.

If an attacker can gain access to a network, there are some attacks that can be levied against layer 2 devices and protocols.

### Layer 2 Attacks: 01:16-02:23

The first Layer 2 attack to know is one that takes advantage of the Address Resolution Protocol, or ARP. ARP was designed to translate IP addresses into MAC addresses and made for speed instead of security. If the attacker is connected to a network, they can easily run an ARP poisoning attack, also known as ARP spoofing.

An ARP poisoning attack starts when the attacker scans a network and gets the list of all connected devices. Then they select two that they want to intercept the communications between. This is usually a computer and its router.

A malicious ARP response is sent out to these devices to update their ARP caches to remap the IP addresses to the attacker's MAC address. The devices now send all communication through the hacker's computer. This is essentially a man-in-the-middle attack that runs on Layer 2.

The main drawback for the attacker is that any HTTPS communication is encrypted and isn't readable. Other than that, a successful ARP poisoning allows the attacker to perform packet sniffing, session hijacking, a DDoS attack, and even alter the communication content.

### MAC Spoofing 02:23-02:49

MAC spoofing is another attack that allows the attacker to intercept communications once the attacker makes contact with the network. A MAC spoofing attack starts with the attacker scanning the network for valid MAC addresses. The attacker changes their system's MAC address to match the gateway's MAC

address and overwrites the switch's CAM table with this new mapping. Then the attacker can route all communication to themselves.

### MAC Flooding 02:49-03:41

MAC flooding is an attack against the network switch. Every switch keeps a MAC table that lists the connected computer's MAC addresses and which ports they're connected to. This allows the switch to send data packets to only the intended recipient.

A MAC flooding attack sends a large amount of Ethernet frames that all have different MAC addresses. The switch starts to add these MAC addresses to its MAC table and eventually gets overloaded. When this happens, the switch dumps the MAC table and begins sending out packets to all ports on the switch in the same way a hub would.

The attacker can use a MAC flooding attack to cause a denial of service, intercept and analyze packets, or implement a more advanced attack, such as ARP poisoning, while the switch is temporarily down.

All these attacks focus on the network. But there are other attacks that focus on systems, like the Domain Name System, or the DNS.

Domain Name System (DNS) Attacks: 03:41-04:06
The DNS is the system that translates IP addresses into names, which usually means website URLs. When you type www.testout.com in your browser, it first asks a local DNS server what the matching IP address is so that it can properly communicate. Attackers can use the DNS to steal data or perform other attacks. One way an attacker can exploit this is through DNS hijacking.

### DNS Hijacking 04:06-04:22

The attacker gains access to a site's DNS records through a variety of techniques, such as phishing, social engineering, or exploiting the domain name registrar. Then they can change information to redirect the URL to their own site or maybe even transfer the whole domain.

### DNS Poisoning 04:22-04:47

DNS poisoning is another type of man-in-the-middle attack. When your browser sends the DNS request to a DNS server, the attacker intercepts the request and sends back a malicious response. This is usually to redirect you to a malicious website, such as a phishing site. These attacks get even worse because the response can be stored in the browser's DNS cache so that every time you go back to the site, it redirects you to the malicious site.

### URL Redirection Attack 04:47-05:09

Another similar type of attack is a URL redirection attack. The attacker usually uses social engineering and phishing emails to get their victim to click on what looks like a legitimate URL link, but is in fact a redirection to a malicious website. The goal is to get the victim to input their login credentials somewhere on the fake site, allowing the attacker to steal them.

### Domain/IP Reputation 05:09-05:33

Any of these attacks can damage an organization's IP or domain reputation. Security firms keep track of a domain's activities. If a domain is being used to send spam emails or is part of a zombie network, security firms might decide to downgrade the domain's reputation. A negative domain reputation can cause it to be put on a list that many security programs block. Obviously, this can badly hurt an organization.

Distributed Denial of Service (DDoS) Attacks: 05:33-06:05
A Distributed Denial of Service attack, or DDoS attack, is designed to essentially bombard the target with more data than it can handle and cause it to shut down. DDoS attacks have a broad range and can target a network, a specific application or service, or even an entire industrial control system. These attacks can be extremely damaging to an organization.

There are many different methods to pull off a DDoS attack. The three main types are Application layer attacks, protocol attacks, and amplification attacks.

### Application Layer DDoS 06:05-06:28

An Application layer attack's goal is to exhaust the target's resources by overloading a specific program or service. For example, we could send a large amount of HTTP requests to a web server and cause it to constantly load a web page. This takes little effort on our end, but the web server has to constantly load and reload images, scripts, and other media. This would overload the web server and crash it.

### Protocol DDoS 06:28-06:51

The attacker could also use TCP flags with different protocols to overload network devices, such as a firewall. One example of this is a SYN flood. The attacker sends a bunch of SYN packets with a spoofed IP address. When the target responds with the SYN-ACK packet, it sends it to the wrong IP address, which means no response comes back and the target eventually gets overwhelmed waiting for the returned responses.

### Amplification DDoS 06:51-07:17

An amplification attack consumes the bandwidth between the target and the internet, effectively cutting the target off. DNS amplification attacks are a common example of this. Basically, the attacker sends a large amount of DNS queries to multiple open DNS servers with the victim's IP address spoofed as the sender. The DNS servers send the DNS responses back to the victim, which can quickly overload their system.

### Summary 07:17-07:51

That'll wrap up this lesson for now. In this lesson, we looked at some attacks a security operations team should be aware of. We first looked at man-in-the-middle attacks, which involve the attacker placing themselves between two devices and intercepting their communications. We looked at Layer 2 attacks and how these can exploit layer 2 devices and protocols. Then we covered the many DNS attacks that can wreak havoc on unsuspecting victims. Finally, we looked at how DDoS attacks work and some methods attackers use to pull them off.

## 11.6.2 Analyzing Network Attacks Facts

For a network security operations team to effectively defend its network, it should understand common attacks and how those attacks work.

This lesson covers the following topics:

<ul>
   <li>
    Man-in-the-middle (MTM) attacks
   </li>
   <li>
    Layer 2 attacks
   </li>
   <li>
    DNS attacks
   </li>
   <li>
    Distributed denial of service (DDoS) attacks
   </li>
</ul>

### Man-in-the-Middle Attacks

A very common attack is the man-in-the-middle attack. In this attack, the attacker is positioned between two devices and intercepts a transmission between them. For example, if a device sends its login information to a website, the hacker intercepts the transmission and steals the credentials. There are a variety of methods that can be used to perform a man-in-the-middle attack. The follow table describes some of them.

<table>
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     MTM Attack
    </th>
    <th scope="col" class="fw-bold">
     Description
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      IP address spoofing
     </td>
     <td>
      The hacker modifies an IP address in a communication. The recipient
      intends to send information to the originally specified IP address, but the packets go to the hacker instead.
     </td>
    </tr>
    <tr>
     <td>
      DNS spoofing
     </td>
     <td>
      The hacker modifies a website's address in the DNS server. The user attempts to go
      to that website, but instead is redirected to the hacker's malicious site.
     </td>
    </tr>
    <tr>
     <td>
      HTTPS spoofing
     </td>
     <td>
      The hacker uses a website name that looks similar to a real site. For example, 
      www.testout.com could be replaced with 
      www.test0ut.com.
     </td>
    </tr>
    <tr>
     <td>
      SSL hijacking
     </td>
     <td>
      The hacker passes forged authentication keys to both the user and application/server. The
      user and application/server are talking directly to each other, but all communication is going through the hacker.
     </td>
    </tr>
    <tr>
     <td>
      Email hijacking
     </td>
     <td>
      The hacker compromises the target's email account and is able to monitor and gather
      information.
     </td>
    </tr>
    <tr>
     <td>
      Wi-Fi eavesdropping
     </td>
     <td>
      This is also known as a evil-twin attack. The hacker tricks users into connecting to a
      malicious wireless network in order to monitor and manipulate the data packets flowing across the wireless network.
     </td>
    </tr>
    <tr>
     <td>
      Browser cookie theft
     </td>
     <td>
      This is also known as session hijacking. When a user logs into a website, a session
      cookie is generated. The hacker intercepts the session cookie and can access the user's website account.
     </td>
    </tr>
   </tbody>
</table>

A variation on the man-in-the-middle attack is the man-in-the-browser attack. This attack works on the application layer and inserts a Trojan horse on the victimâ€™s computer. The Trojan horse exploits the browser to manipulate the data and send it to the attacker.

### Layer 2 Attacks

When an attacker gains access to the network, attacks can be levied against layer 2 devices and protocols. The following table describes some of these attacks:

<table>
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     Layer 2 Attack
    </th>
    <th scope="col" class="fw-bold">
     Description
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      The Address Resolution Protocol (ARP) poisoning
     </td>
     <td>
      ARP is used to translate IP addresses into MAC addresses. ARP was
          designed for speed, not security. It can be exploited by an attacker using ARP poisoning, also referred to as an ARP spoofing attack.
      <p>
       To perform an ARP poisoning attack, the attacker does the following:
       </p><ol>
        <li>
         Scans the network to get a list of all connected devices.
        </li>
        <li>
         Selects two devices to intercept communication between. This is usually a computer and
            the router.
        </li>
        <li>
         Sends a malicious ARP request to both devices to update their ARP caches, remapping the IP address of each to the attacker's MAC address.
        </li>
       </ol>
       <p>
        The devices then send all communication between the two to the attacker's computer.
        </p><p>
         A successful ARP poisoning attack will allow the hacker to:
        </p>
        <ul>
         <li>
          Perform packet sniffing
         </li>
         <li>
          Carry out session hijacking attacks
         </li>
         <li>
          Alter the communications between the two devices
         </li>
         <li>
          Perform a distributed denial of service attack
         </li>
        </ul>
        <p>
         To protect against ARP poisoning attacks, use HTTPS whenever possible. Because HTTPS is encrypted, the
          attacker is unable to read or modify the data. This makes the ARP poisoning attack worthless for the hacker.
        </p>
       <p></p>
      <p></p>
     </td>
    </tr>
    <tr>
     <td>
      MAC spoofing
     </td>
     <td>
      A MAC spoofing attack starts with the attacker scanning the network for valid MAC addresses. The
          attacker spoofs the MAC address to match the gatewayâ€™s and overwrites the switchâ€™s CAM table with
          this new mapping.
      <p>
       All data that would normally go to the gateway is sent to the attacker's computer.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      MAC flooding
     </td>
     <td>
      MAC flooding is an attack against the network switch. Network switches maintain a MAC table. The MAC
          table is a list of the MAC addresses for each connected device and the port each device is connected to. The MAC table allows
          the switch to send data packets to only the intended recipient.
      <p>
       In a MAC flooding attack, the attacker sends a large number of Ethernet frames with different MAC
          addresses. The switch begins adding these new MAC addresses to the MAC table. Eventually, the MAC table gets
          overloaded causing the switch to dump the MAC table. During this time, the switch begins sending packets to all ports,
          just like a hub.
      </p>
      <p>
       An attacker can use a MAC Flooding attack to:
      </p>
      <ul>
       <li>
        Carry out a DDoS attack
       </li>
       <li>
        Intercept and analyze packets
       </li>
       <li>
        Perform advanced attacks such as ARP poisoning while the switch is down
       </li>
      </ul>
     </td>
    </tr>
   </tbody>
</table>

### Domain Name System (DNS) Attacks

DNS is the system that translates IP addresses into names, such as a websiteâ€™s URL. Attackers can use DNS to steal data or perform other attacks. The following table explains some common DNS attacks:

<table>
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     DNS Attack
    </th>
    <th scope="col" class="fw-bold">
     Description
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      DNS hijacking
     </td>
     <td>
      <p>
       To carry out a DNS hijacking attack, the attacker needs to gain access to the DNS records of a website. A variety of
            techniques can be used to gain access. These include:
      </p>
      <ul>
       <li>
        Using phishing attacks
       </li>
       <li>
        Using social engineering
       </li>
       <li>
        Exploiting a vulnerability in the domain name registrar
       </li>
      </ul>
      <p>
       With access to the DNS records, the attacker can change the record to redirect the URL. This means that when attempting to go the legitimate site, the user is redirected to the
            attacker's malicious site. The attacker can also transfer the DNS or perform other malicious
            activities.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      DNS poisoning
     </td>
     <td>
      DNS poisoning is a man-in-the-middle type of attack. The attacker intercepts DNS requests from a
          browser and sends back a malicious response. The response usually redirects the user to the attacker's malicious site. The DNS response also gets stored in the browser's DNS cache. This means that every time the user enters the website URL, the browser's cache redirects to the malicious site.
     </td>
    </tr>
    <tr>
     <td>
      URL redirection attack
     </td>
     <td>
      A URL redirection attack is very similar to the DNS poisoning attack in that the attacker's goal
          is to get the user to go to a different site than the user intends to. In this attack, the attacker uses social engineering
          and phishing emails to get the victim to click what looks like a legitimate link, but the link sends the
          victim to the attacker's malicious site.
      <p>
       The goal is usually to get the victim to input login credentials into the fake site allowing the attacker to
          steal them.
&gt;
      </p>
     </td>
    </tr>
    <tr>
     <td>
      Domain/IP reputation attack
     </td>
     <td>
      Security firms keep track of a domainâ€™s activities to determine if it is being used for malicious activity. The activity would include sending spam emails or if the domain is being used as part of a zombie network to perform denial of service (DOS) attacks. Either activity would result in the domainâ€™s reputation being degraded.
      <p>
       A negative domain reputation can cause the domain to be put on a list that many security programs use to identify sites to block and prohibit users from visiting. Domain reputation attacks can be extremely devastating to an organization.
      </p>
     </td>
    </tr>
   </tbody>
</table>

### Distributed Denial of Service

A distributed denial of service attack is designed to bombard the target with more data than it can handle causing it to shut down. A DDoS attack will usually target a network; specific applications or services; and even the systems used to monitor and control industrial operations (Operational Technology).

There are many different methods to pull off a DDoS attack. The following table explains the three main methods.

<table>
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     DDoS Attack Method
    </th>
    <th scope="col" class="fw-bold">
     Description
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      Application layer DDoS
     </td>
     <td>
      An application layer attackâ€™s goal is to exhaust the targetâ€™s resources by overloading a specific
          program or service.
      <p>
       For example, an attacker sends a large number of HTTP requests to a web server causing it to repeatedly load a web
          page. This method takes little effort by the attacker, but will quickly overwhelm the web server as it repeatedly loads
          the media files including images, audio, and video.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      Protocol DDoS
     </td>
     <td>
      The attacker can also target different protocols such as TCP flags to overload network devices such as a firewall. A SYN flood attack is a common example of this method:
      <ul>
       <li>
        The attacker sends a large number of SYN packets with a spoofed IP address.
       </li>
       <li>
        The victim responds with the SYN-ACK packet, but it goes to the wrong IP address. The victim never receives a response.
       </li>
       <li>
        The victim leaves the connection open waiting for a response to complete the 3-way handshake.
       </li>
       <li>
        Eventually the victim gets overwhelmed waiting for the response packets to come back.
       </li>
      </ul>
     </td>
    </tr>
    <tr>
     <td>
      Amplification DDoS
     </td>
     <td>
      An amplification attack consumes the bandwidth between the victim and the internet, effectively
          cutting the victim off. DNS amplification attacks are a common example of this.
      <ul>
       <li>
        The attacker sends a large number of DNS queries to multiple open DNS servers with the victim's IP address spoofed as the sender.
       </li>
       <li>
        The DNS servers send the DNS responses back to the victim.
       </li>
       <li>
        The victim quickly get overloaded with the amount of data and is unable to function.
       </li>
      </ul>
     </td>
    </tr>
   </tbody>
</table>

## 11.6.3 Performing ARP Poisoning

### Poison ARP 00:00-00:33

Man-in-the-Middle attacks are very popular because they're so productive. When a hacker puts themselves between a victim and the machine they're connecting to, they can capture traffic, delete traffic, inject their own traffic, spoof DNS, and capture passwords. Imagine the damage that can happen if someone captures important documents and leaks their contents or steals the information. In this demo, we're going to illustrate how to capture a password with a man-in-the middle attack so that, as an Ethical Hacker, you can take countermeasures to protect your organization.

### Scan Subnet with NMAP 00:33-01:30

So, let's get started. First, I'm going to scan my subnet to see what hosts are connect and identify my router. Inside this terminal on my Kali Linux machine, I can type in "nmap 10.10.10.0/24' and press Enter. This is going to scan my 10.10.10.0 subnet. It finished pretty quickly.

Now let's scroll up and see what we found. Up there, I found my router, router.CorpNet.xyz with an IP address of 10.10.10.1. We need to remember this information for later.

Here, I have another device on the CorpNet domain with an IP of 10.10.10.169.

I'll scroll down a bit. This device, here, is the one I'm most interested in, PC-12 with an IP ending in 195. This is the machine that's going to be my victim machine and the one that I'm going to try to capture passwords from. Let' go ahead and close this terminal.

### Find our Hosts 01:30-02:29

Now I want to open up Ettercap. Ettercap comes in both a GUI and a command line interface. It's pre-installed as part of Kali Linux, so we don't have to install or download anything. To open Ettercap, I go up here, to Applications, go down to Sniffing & Spoofing, and then, over to the right, find Ettercap. The Ettercap GUI will appear. And from there, I'll come up to the Sniff tab and select Unified Sniffing. That will launch a dialog box, where I'm prompted to select my Network interface. I only have two options. Depending on your system, you may have multiple interfaces such as a WLAN interface or multiple LAN interfaces. I'm going to leave it with eth0 and click OK.

Now let's scan our subnet for hosts. As you'll recall from our nmap scan, I had three hosts. I'll come up to the Hosts tab, come down to Scan for hosts, and select it. Ettercap starts scanning the subnet for hosts. Down here, you can see that it scanned 255 hosts and found three.

### Select Targets 02:29-03:18

Now I want to list these hosts, so I'll go up to the Host tab. This time, we'll come down to the Hosts list and select it. Here, we can see our three hosts. Remember that this 10.10.10.1 was our router, and our victim machine is the one that ended with 195.

Let's go back up here, to the router, and select it. Down here, I want to select Add to Target 1. Now I'll come back up and select the host ending in 195. And then we'll go back down. This time, we'll select Add to Target 2.

So, what am I doing here? This is where I'm going to insert myself between the router and the victim. To do that, I'm going to go up to the MITM tab, come down a bit, and select ARP poisoning. In this new dialog box, I want to check the box that says "Sniff remote connections" and click OK.

### Start Sniffing 03:18-03:37

All right. Now, I'll come up to Start and select Start sniffing. I should have stopped sniffing earlier, but it'll still work fine. Now Ettercap is sniffing our traffic between our victim and the router. We just need to wait for our victim to try to log into a website. Let's jump over to our Windows machine, the one with the IP that ended with 195.

### Capture Credentials 03:37-04:29

All right. I'm over on the Windows machine now, and I've brought up this website. It's a Moodle site, a popular learning management platform used by many educational organizations. I've hidden the web address, but it's an HTTP site, not HTTPS. Just to confirm that we're on the correct machine, I'll quickly open a command prompt and do an ipconfig to verify the IP address. It's the correct machine. It looks good. I'll close this window.

Let's go ahead and log in with some credentials. I'll just type in the word 'teacher', and I'll use 'letmein' for the password. I'll click Log in. It tells me that I have an invalid login, and it wants me to try logging in again. That's totally okay for what we're demonstrating. Let's jump back over to our Kali Linux machine and see what's happening with Ettercap.

### View our Results 04:29-05:01

Okay. I'm back on Kali, and here's Ettercap. Down here, at the bottom, you can see that when I attempted to log in, Ettercap captured the username "teacher" and the password "letmein". Of course, this isn't the correct username and password, but Ettercap would capture whatever was entered, and we assume that the user would eventually enter their correct credentials.

The important thing to remember here is that this method does not work with HTTPS. But most users have a habit of using the same credentials for multiple sites. So, once you get the credentials to one site, you'll likely have credentials for multiple sites.

### Summary 05:01-05:15

That's it for this demo. In this demo, we used Ettercap to create a man-in-the-middle attack with ARP poisoning to capture login credentials through a website.

## 11.6.5 Performing DNS Poisoning

### Poison DNS 00:00-00:37

DNS Spoofing, sometimes referred to as DNS cache poisoning, is an attack where a rogue device directs DNS requests on a network. This basically means that an attacker manipulates the DNS to redirect DNS traffic. This type of attack is very difficult to detect, which makes it quite dangerous. In this demo, we're going to redirect DNS to our Kali Linux machine, spoof the DNS, and point to a web page I've set up.

For this demo, we're going to use Kali Linux with Ettercap. Ettercap has a GUI interface. That's what we're going to use. But we need to do a few other things before we get started.

### Modify the etter.conf File 00:37-01:35

I'm going to open up a terminal here, on Kali Linux. We need to check the etter.config file. The easiest way to find this file is to just type 'locate etter.conf' and press Enter. The path I'm interested is this one, right up here. I'm going to use the program Leafpad to open the file. We'll type in 'leafpad /etc/ettercap/etter.conf' and press Enter. And Leafpad opens my file.

Now we need to edit these two lines of code, uid and gid. I need to change both of these values to zero.

After that, we need to scroll down a bit, to where it says Linux. Right under there, we want to find the iptables. These two lines are commented out with the pound sign (#). Just delete the two pound signs from these lines of code. There's one here and one here. So, now that we've done that, we'll save our file and close this window.

### Edit the etter.dns Host File 01:35-02:30

Now that we're done with that, we need to edit our etter.dns file. I'm back in the terminal. Once again, to find this file, I can just type in 'locate etter.dns'. And, just like before, I'll use Leafpad to open it by typing 'leafpad etter.dns'. The file opens up.

I need to add a line to this host file. I'll scroll down until I see these few lines with Microsoft in them. Right above those lines, I want to add this line, here: '\* A 10.10.10.197'. By doing this, we're telling all of the DNS traffic on the network to go to this IP address, which is actually my Kali Linux system's IP address. The Microsoft lines are not commented out by default, but I went ahead and put pound signs (#) in front of them. We don't want to redirect their DNS. Before I exit, I want to go up and save the file.

### Edit index.html 02:30-03:36

All right. We have some more editing to do here. Now I need to edit my index.html file. Since we're spoofing the DNS and redirecting traffic to our Kali system, I need to give the users something to see, so I'll edit the index page.

To get to that file, I'll come up to Places and come down here, to Computer. From there, I need to find the folder called var and open it. Within var, I'll go over to the www folder, then to the html folder. I've already made some changes in here. One of the things I did was copy my index.html file and rename it. Let's open this old file and see what the contents look like.

Okay, our file is open. And, like I said, by default, this is our index.html file on this Linux system. I didn't want to modify the original in case I need to restore it later, so I made this copy. Now let's close this one and open up the modified copy that I created. Once again, I'll use Leafpad to do that. Here, you can see I made a very simple landing page for our victims. It says, "You have been denied access to this site. Nice try!" I've already saved it, so I'll go ahead and close this file.

### Set up Ettercap 03:36-05:28

We're done editing files. Now we can go to `Applications > Sniffing & Spoofing > Ettercap`. Ettercap opens for us. And the first thing we need to do here is come up to the Sniff tab and select Unified Sniffing. A dialog box opens up. We want to select our network adapter. In our case, that's eth0. Click OK. We actually want to come back up to Start and select Stop Sniffing because we're not quite ready yet.

We're going to go over to the Hosts tab and select the Scan for Hosts selection. Ettercap will do its thing and start scanning. You can see, down here, that we found three hosts.

Now let's go up to Hosts again. This time, select the Hosts list. And down here, you can see the three hosts. Previously, I ran NMAP and figured out that this top host is my router, and this bottom host is my victim machine, the one I want to attack so that anytime this machine goes to a website, the DNS is going to point them to my Kali Linux machine's IP address. So, while my victim IP is selected, I'll come down here and click Add to Target 1.

Now we'll go to `Plugins > Manage the plugins` and select the dns_spoof option. Now, if we look down here, in the lower pane, you can see it says, "Activating dns_spoof plugin..."

All right, we're almost done. I need to come up to the MITM tab and select ARP poisoning. When the dialog opens up, we need to check the box for Sniff remote connections and then click OK.

We need to start the Apache web service on the Kali machine to actually make it into a web server. I do that by opening up a terminal and typing in 'service apache2 start'. Nothing really exciting happens, but this command starts the Apache service for us.

That wraps up our steps on this Kali system. Now we need to see what happens when our victim tries to surf the web. We'll do that from a Windows machine.

### Test on a Windows Machine 05:28-05:58

All right. I'm on a Windows machine now. I'll go to a command prompt to check our IP address. I'll type in 'ipconfig', and we can confirm that the IP ends with 195, so this is the right machine. I'll close this window.

Down here, I'll launch Google Chrome, and I'll type in 'www.testout.com'. When the page launches, it takes me to the index.html page on my Kali Linux system and displays the message we typed. That confirms that our DNS has been spoofed and redirected.

### Summary 05:58-06:18

That's it for this demo. In this demo, we configured our Kali Linux machine to redirect DNS requests and send the traffic to our modified index.html page. We discussed how we had to edit the files to make this happen and how to configure Ettercap to perform the DNS spoof.

## 11.6.7 Performing a SYN Flood

### Perform a SYN Flood 00:00-00:53

We've already talked about the three-way handshake, but let's quickly review it again. A three-way handshake starts when a client sends a connection request to a server, saying, "Let's connect." This is called a SYN message. The server acknowledges this request by sending a SYN-ACK message back to the client, saying, "Okay, I'll talk to you." Then the client sends back an ACK message, saying, "Great, we're talking." This is a three-way handshake.

When we're doing a SYN Flood, we're doing only part of this process. The attacker, or the client, doesn't respond back to the final ACK message. The server sits and waits with a half-open connection that's never completed, denying others communication with the server in the meantime. Another method is to spoof the IP address so the server responds to the spoofed IP address, never getting any response.

I'm going to demonstrate how all this works.

### Identify the Victim 00:53-01:57

First, we need to choose a victim. I've already identified the IP address of my victim on my Kali Linux system, and I've run Zenmap against it. I scanned for all open ports from 0 to 65535. Here, you can see that we have all these ports. We're going to attack port 135. I'll minimize Zenmap for now.

To get an idea of what happens during this attack, let's open up the victim machine. It's a Windows 10 machine, and I've installed Wireshark on it. I'm going to go ahead and open Wireshark by clicking on the shark fin. We're doing this to see what happens when this machine is attacked.

I'm also going to come open Task Manager. We need the Performance tab. You can see my CPU is relaxed. We had a spike here, probably when we opened Wireshark. Down here, we really have no Ethernet activity. I actually need to go back over to Wireshark and click the shark fin to start sniffing traffic. I'll just leave for now and go back to Kali Linux.

### Run the Metasploit Database 01:57-02:32

I'm in Kali Linux, and we're going to use Metasploit for this attack. First, I'll open a terminal here. After it opens, I want to start the database. The Kali Linux Network Services Policy states that no network services, including database services, will run on boot by default, so we need to get the database going in order to get Metasploit up and running with database support. From the terminal, we'll type 'service postgresql start' and press Enter. This starts the database that we'll need. A lot of times, I'll forget to do this, and you'll get an error letting you know it can't connect to the database.

### Load the SYN Flood Module in Metasploit 02:32-02:47

All right. Now, let's start Metasploit. Type in 'msfconsole' and press Enter. This sometimes takes a few minutes to get started, so be patient. I'll adjust the terminal window and clear the screen.

### Configure SYN Flood Options 02:47-04:23

Now, with Metasploit up and running, I want to search for SYN flood. I'll type in 'search synflood' and press Enter. And I get a matching module.

This is easy because there's only one module listed, so that's the one we're going to use. I'll use that module by copying this part, here. We'll type in 'use', paste in auxiliary/dos/tcp/synflood, and press Enter.

Now you can see that it loaded that module here, in red. We want to see the options for using this, so let's type 'show options'.

Okay. There are a few things we need to do here. We need to configure the remote host, shown here. I also want to configure the remote port. If you remember from our Zenmap scan, that's going to be port 135. I'm also going to spoof my IP address, down here. Okay. Let's configure these.

I'll start with the remote target. I'll type in 'set RHOST 10.10.10.195' and press Enter. Let's set the remote port, 'set RPORT 135', and press Enter.

Next, let's set the spoofed IP address by typing 'set SHOST 10.10.10.50'. I just randomly picked that 50, but I do know that this IP isn't used on my network.

Now, let's look at our options again by typing 'show options'. We have everything in there, and it's just the way we planned, so it looks like we're ready to attack. I'll type 'clear' to clean up the screen.

### Run SYN Flood Exploit 04:23-05:35

To run the exploit and start our SYN Flood, we just type in 'exploit' and press Enter. It says, "Hey, I'm SYN flooding 10.10.10.195 on port 135." Well, to be sure, let's jump back over to our Windows 10, the victim, and see what's going on.

I'm on the Windows 10 machine. First, let's look at Wireshark. I have a ton of traffic going from 10.50 to 10.195. Over here, you can see that SYN requests are happening. I'm going to stop sniffing here. Now let's highlight one of these. If I look in the lower pane, I can see one thing, the source's MAC address. It ends in 1c. That can help me determine the attacker's real IP address, since the MAC isn't spoofed. Now let's look at Task Manger.

As you recall, we looked at the CPU and Ethernet usage here. You can see that my CPU is a little higher than what it was previously; but it's not as high as I would have guessed. Also, if you look at the Ethernet, you can see that it's really busy. Remember, that's an attack from just one machine. Imagine if it were coming from 10 machines or hundreds of machines. It wouldn't take much to overwhelm this system.

### Countermeasures for SYN Floods 05:35-05:52

So, how do you stop SYN floods from happening? There are several methods. Admins used to block the port of the incoming SYN requests, but that didn't work very well. Now, admins can use SYN cookies, RST cookies, filtering, and Microblocks to mitigate SYN flood attacks, as well as other methods.

### Summary 05:52-06:20

That's it for this demo. In this demo, we started by reviewing the three-way TCP handshake. We discussed how a SYN flood begins with an incomplete handshake, leaving the server sitting and waiting. We performed a SYN flood using Metasploit. We viewed Wireshark and our performance on the victim machine to analyze the attack's effect. We ended by talking about a few of the countermeasures that help prevent SYN flooding.

## 11.6.9 Examining DNS Attacks

### Examining DNS Attacks 00:00-00:15

In this demo, we're going to look at a few ways an attacker may use the DNS system to get information about the computers in an organization, and also to compromise a machine and get access to information.

### Reconnaissance Using DNS Servers 00:15-01:43

Let's first look at doing reconnaissance using DNS servers. One way this can be done is with the nslookup command.

You see that I have a PowerShell command prompt window open here, and if you just type nslookup, that will put you into this utility. nslookup is used to troubleshoot DNS server settings.

You can see here that the DNS server that I'll be using is this one. It's the default one that I have configured for my machine here. When a computer wants to resolve a name, the first thing it does is look into a special file called a host file.

We'll talk more about that later, but essentially the host file can contain mappings between domain names and specific IP addresses. If it's not in the host file, then an operating system checks its DNS cache.

If the mapping is in there, then it uses the IP address that it finds. If not, it goes out and does the name resolution with the DNS server that's configured.

In this case, nslookup simply allows us to do those queries by passing the cache that might be on a local operating system.

So, if we want to, here, we can simply type in the name that we want to resolve like google.com, and it will go out and resolve that. My DNS server here goes out and says, I don't know what IP address that is associated with.

And then it issues the query to the resolver that it's pointing to. And you see here the IP address of www.google.com. Of course, we can try other ones like testout.com and others in you'll see that the resolution occurs appropriately.

For this demo, I've set up a domain that we can use to see how a few vulnerabilities work.

### Domain Information 01:43-02:16

One vulnerability that exists with DNS servers is the ability to find out all the domain information associated with a particular name. One way we can do that is using the list command.

To do that, we type ls; we specify the domain that we want using the -d flag; and then we can say ajptech.net. This will tell us all of the computers that are associated with the ajptech domain.

If you do that, you see that we have a full list of all the machines.

Now, this is just a test environment. I've just listed a few servers, etc.

### Zone Transfer 02:16-04:40

You can imagine in an organization that has hundreds of computers, this provides very nice information to know which IP addresses we should spend time attacking, based on these records.

This is referred to as a zone transfer, and we need to make sure that our DNS servers in our organization don't allow zone transfers to just anyone.

They're useful because you don't want just a single server, and so you want to share those records with other secondary zones, but you need to restrict who is allowed to do those zone transfers.

Let's take a look at that, inside of Windows Server 2019. You see here I have launched the DNS manager on the server.

If you haven't installed that role before, it's super simple to do, and you do so before configuring these different zones. Let's go ahead and look at some of the properties that you might want to set.

The one that's of most interest to us right now is this Zone Transfers tab. This basically specifies who is allowed to gather all those records at once, and you can see here that we have 'To any server'.

We could come in and just say, 'No zone transfers are allowed.' But as I explained a minute ago, that's useful, because if this is the primary zone for that domain name, then you want to have a secondary zone.

You don't want a single point of failure here, and so you want to be able to allow zone transfers.

You can only allow servers in the Name Servers tab, which is nice because usually you set those up specific to a domain, and that would be anything that's listed here, or you can restrict it to a specific IP address.

Let's go ahead and apply those settings. Let's say that we're going to only allow the following servers, and I'll just put in a fake IP address here right now. It won't resolve right now, but that's okay. But it will restrict those zone transfers.

Let's go ahead and switch back over to our PowerShell window, and let's try that same command. You can see now that it says it has refused transferring all that information from the zone--perfect.

Now when people are doing reconnaissance, they won't be able to see everything that we have in that zone.

However, the domain name server continues to work, so I can say server1, and you can see that that name resolution continues to work. So, make sure you secure your zone transfers.

Today, restricting zone transfers is commonplace; in fact, it's the default of many operating systems, and it's the best practice everybody should have. If your DNS server isn't configured that way, you want to make sure that you take care of that. Now let's move on to a couple of other concepts.

### Distributor Reflection 04:40-06:37

There are many different DNS attacks, such as distributor reflection, denial of service attacks, cache poisoning, TCP send floods, and others.

Let me just briefly explain one of these to give you a flavor.

A distributor reflection denial of service attack occurs when several DNS queries are sent to a DNS server that has an open resolver, and that DNS server responds to the spoofed address with a large payload.

The key to the attack is that the attacker only has to send a small packet of information to the DNS server, and then the DNS server sends a large response, but that response doesn't go back to the attacker; it sends it to the target that the attacker listed, using a spoofed source IP address.

In short, the attacker uses the DNS to create a denial of service attack against the third party. In this case, you need to make sure that you don't have any open resolvers.

An open resolver is essentially a DNS server that's willing to resolve names for third parties.

Usually you protect this in a couple of different ways--either restricting the DNS requests that come into your DNS server, that is, you don't allow outside requests; or simply not having any forwarding capabilities associated with your DNS server, and making sure that recursion is disabled on your DNS server.

Let me show you that setting quickly here. If you come to your server, you'll see the properties of the server itself. We are in the zone from before. We're going to go over here to the Advanced tab.

You want to make sure that this option is set, so that you disable the recursion. That, of course, disables the forwarders as indicated there. I'll say OK there.

Then I'll come over to the Forwarders tab here. You can see that I'm set up, but it's not using those anymore. The downside of this is we need to use a different DNS server in order to do our name resolution.

This server now can only do name resolution for the domains that are on it, but that's okay. That's best practice. You definitely don't want to be susceptible to those amplification attacks that I just explained.

Let's come back here to our PowerShell prompt and get out of the nslookup command.

### Clear out the Cache 06:37-08:58

Let me show you a couple of other things. I'll go ahead and clear the screen, as well.

A minute ago, I explained that when name resolution needs to occur on an operating system, it first checks the set host file, and then it goes to cache, sees what's in cache and uses that if there is something that's associated with that name, and then it goes and does the name resolution using the DNS system.

Let's go ahead and take a look at that cache.

But before we do so, we need to make sure that we have something in cache. I'll simply go ahead and try to ping google.com. You can see that I get a response.

Now, to see what's in cache, you simply say ipconfig /displaydns. You can see that I have several different entries in there.

I have some of those entries because I have a browser running on my system, and it's already resolved some names. Let's go ahead and try to clear that out. To clear out your cache, you type ipconfig /flushdns.

Let's ping google.com, and then let's go ahead and see if we can see just those name resolutions.

You can see here there is only one record now when we display the dns cache.

So, this cache constantly keeps track of what's been resolved previously so it doesn't have to invoke the DNS system for every single request if it already knows that information. It saves time.

Each of these records also has a time to live, as you can see there, and so they're constantly refreshing as the system is being used.

One mistake that some people come across when they're trying to resolve DNS issues is they forget to clear out their cache.

They hit a site that's in cache, they make some changes, and they don't realize that it's actually pulling it out of cache instead of going on. I want to make sure you're aware of how cache works.

Now what if we could poison the cache or insert a record in there that wasn't legitimate, that came from another source?

This is a little bit harder to architect, but if we could specify a different IP address for the name server, the DNS server, we could pull records from it. It would be saved in the cache or locally, and then subsequent resolutions would pull the IP address out of the cache.

Indeed, that's one attack that individuals use when exploiting the DNS system. We're not going to show that to you today, but I want to show you one other concept before we wrap up this demo, and that has to do with the host file that I mentioned a few minutes ago.

### The Host File 08:58-11:24

This is the host file I mentioned a minute ago, and you can see that it's located in Windows System32\drivers\etc\hosts. In this file, you can include specific mappings between a domain name and an IP address.

Before there was this DNS system, this file was distributed to all the computers on the internet, and so there's just a huge file of these mappings so that you wouldn't have to remember the specific IP addresses.

Thankfully, the DNS system came along, making our lives a lot easier and being allowed to update, but this is still in place. And as I mentioned, it gets checked before the OS resolver cache, before going out to the DNS system to resolve domain names.

You can see an example of how you can use this. But before I put in an example, let me show you a legitimate site so that you can see how this works. Let's go to cat-bounce.com, just a random site.

You can see that there's something out there. If we want to redirect individuals, instead of them going to this site to a different site, we can go into the host file and add a mapping that we're interested in.

You can see that we put the IP address first, and then the domain name. So, I know that the duckduckgo server is at the following address, and then I can simply put www.cat-bounce.com, and I'll save that.

Recent browsers have incorporated a DNS cache inside of the browser itself.

They do this because it gives them a competitive advantage to go ahead and resolve those domain names ahead of time, the minute that they show up on a page and that you might potentially click on.

Lets open an incognito window to bypass the cache.

If we go to www.cat-bounce.com, you see that it forwards on duckduckgo.com. I hope you can see how dangerous this could be. This is considered host file manipulation.

However, an attacker could simply keep that in place and use. An innocent individual wouldn't have any idea that you weren't on the legitimate site.

Consider banking sites or corporate sites, anywhere where sensitive information might be shared. An attacker can get access to this host file, present what looks to be a legitimate website, and then siphon off data as you use it.

It's also good to know that you can use host file to block malicious information, if you are a systems administrator.

This is a common site. It looks a little dated, but the information is pretty good on it. You can come and download a specific host file to block out a bunch of bad or malicious sites.

The IP address you see is a null IP address. In other words, if we added this to our host file and you went there, it simply wouldn't go anywhere.

One thing to note, you'll need to have administrator rights to adjust the host file.

### Summary 11:24-11:57

That's it for this demo. In this demo, we've look at a few ways that an attacker can use the DNS system to get out information about computers in the organization and to compromise a machine and eventually grab sensitive information.

We've looked at the nslookup command. We've looked at zone transfers. We've looked at securing the open resolvers. And we've looked at the host file and clearing cache.

It's really important that you protect your DNS servers and make sure that you aren't taken advantage of in that way.

## 11.6.10 Malicious Code

### Malicious Code 00:00-00:41

Malicious software is perhaps the most dangerous threat to any computing device. It's so prevalent that most people combine the words â€˜malicious software' and just call it malware. It isn't always coded using advanced programming languages. In fact, Python is one of the common languages used to design malicious codes. Sometimes a simple script can exploit built-in OS features such as shells. Even application features like macros can be used to develop and execute malicious codes. In this lesson, we'll look at how malicious code and scripts are designed and executed.

### Python 00:41-01:56

Python is one of the most popular programming languages. It was first released in 1991. It's designed to be easy to learn and read, and it works with most operating systems, including Windows, MacOS, and Linux.

Aside from being easy to read and understand, Python can take advantage of a massive amount of open-source Python packages and repositories. These add-ons make it that much easier to develop a Python script to do whatever you want.

Python is often used in the development of Remote Access Trojans, or RATs. This is because Python makes it very easy to implement libraries that can take screenshots, use a webcam, and even make web requests. It's also easy develop malicious code that can run on many different systems and devices, including Android devices.

One of the main drawbacks to using Python for malware is that its file sizes are larger than other common languages. Python must also be installed on the system for a Python script to run. This is fine for MacOS and Linux. Windows doesn't come with it installed, but it's pretty easy to convert Python scripts to Windows-compatible executables.

### Command Shells 01:56-02:39

In addition to Python, attackers often use shells. A shell is a program that provides an interface that gives users access to operating system functions and services. We generally associate shells with command line interfaces, but they can have graphical interfaces too. These programs can provide access to core operating system functions, which makes them exploitation targets.

You can type commands directly into the shell window or run pre-written scripts. A script is simply a plain text file with the commands you want to run typed in, just like you would type them into the shell window. When the script runs, the commands are executed.

### PowerShell 02:39-03:52

Now let's talk about PowerShell. PowerShell is a management framework that Microsoft developed to replace the Command Prompt and give users more power and control over the Windows system. PowerShell is built on the .NET frameworks and can run on multiple operating systems, including MacOS and Linux.

PowerShell uses cmdlets to carry out commands. Cmdlets are tiny scripts that are used to perform certain functions. Some cmdlets replace older commands and provide more advanced functions. Users can combine these cmdlets to develop scripts that automate tasks and configure just about anything in Windows.

Malicious PowerShell scripts pose a major security threat. For example, let's talk about fileless malware. PowerShell scripts can run in the memory of the system--they don't need an actual file executable to run. An attacker can take advantage of this function by sending a phishing email. When the victim clicks the link, a PowerShell script is loaded in the background that can download and run other malware programs. Because these attacks are fileless, anti-virus programs generally can't detect them.

### Bash 03:52-04:46

Bash is a command shell and scripting language used in most Linux distros and MacOS versions prior to Catalina. Bash was released in 1989, and it's still heavily used. When you use a command in Linux, Bash works in the background to execute that command using environment variables.

Since many web servers run on Linux's Apache platform, Bash malware can be designed to attack these systems. A well-known malware called Shellshock uses Bash commands to exploit a flaw within the Bash shell itself, allowing an attacker to inject malicious commands.

Malware that exploits these shell programs essentially use the operating system against itself. This makes these scripts difficult to detect and prevent. Keeping anti-malware up to date and training users not to click unknown links or run unknown programs is vital.

### Macros 04:46-06:18

All right. Next, we're going to talk about macros, which are similar to scripts. Macros are little bits of code that can be used to run a series of steps or functions in an application, making common tasks more efficient. Many different programs can make use of macros, but the most common use of macros is in the Microsoft Office programs.

Microsoft Office programs can use the Visual Basic for Applications, or VBA, programming language to create and run macros. VBA can be a powerful programming language and can even be used to run commands in Windows using the shell function or delete files from your hard drive using the Kill function.

An example of a devastating macro malware is the macro virus Melissa. In 1999, Melissa was distributed as a Word document, and when it was opened, a macro ran that pulled the first 50 users from the user's Outlook address book and mailed a copy of the infected Word document. Melissa spread extremely quickly and shut down more than 300 corporations and government agencies temporarily as their networks were overloaded. The total estimated damage of Melissa was around $80 million dollars.

In newer version of Microsoft Office, macros are disabled by default, and a user must specifically allow them to run. This helps to keep our systems safe from malicious code. But if someone uses macros often and has them enabled, their system is extremely vulnerable.

### Summary 06:18-07:06

That'll wrap up this lesson. We've covered some methods for generating and distributing malicious code. First, we looked at the popular scripting language Python. Python is used to create all sorts of great programs and scripts, but because of its ease of use, many hackers use it to develop malicious code.

Then we covered command shells like PowerShell and Bash. These shells generally allow access to all sorts of critical operating system functions, meaning malicious code can cause them serious damage.

Finally, we looked at how macros can be exploited to run malicious code on a computer. Microsoft Office programs use the VBA programming language to develop macros to automate tasks, but it can be exploited to distribute malicious code.

## 11.6.11 Malicious Code Facts

Malicious software (malware) is perhaps the most dangerous threat to any computing device. Malware can be created using a variety of programming languages and methods.

This lesson covers the following topics:

<ul>
   <li>
    Python
   </li>
   <li>
    Command shells
   </li>
   <li>
    Macros
   </li>
</ul>

### Python

Python has become one of the most popular programming languages. First released in 1991, Python is designed to be easy to learn and read. It can be used on most operating systems including Windows, MacOS, and Linux. Python can also take advantage of open-source Python packages and repositories.

Many Remote Access Trojans (RATs) are designed using Python. Python makes it easy to implement libraries that allow the RAT to perform functions such as:

<ul>
   <li>
    Taking screenshots
   </li>
   <li>
    Enabling the webcam and viewing it remotely
   </li>
   <li>
    Making web requests
   </li>
   <li>
    Making phone calls
   </li>
</ul>

Python also makes it very simple to develop malicious code that can be run on many different systems and devices, including Android devices.

One of the main drawbacks to using Python for malware is the file size. Python files are larger than other common languages. Also, Python must be installed on a system for a Python script to run. This works for MacOS and Linux, but Windows doesnâ€™t come with it installed. Python scripts can be converted to Windows compatible executables fairly easily though.

### Command Shells

A shell provides an interface for users to access operating system functions and services. Shells are generally associated with command line interfaces, but they can have graphical interfaces also.

Because these programs provide access to core operating system functions, they are extremely dangerous when exploited.

Commands can be typed directly into the shell program or can be run from a script. A script is a plain-text document that has the commands typed out just like they would be in the shell. When the script is run, the commands are executed.

Two of the more heavily used shells are PowerShell and Bash. The following table describes these two shell programs:

<table>
   <thead>
    <tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     Shell Program
    </th>
    <th scope="col" class="fw-bold">
     Description
    </th>
   </tr></thead>
   <tbody>
    <tr>
     <td>
      PowerShell
     </td>
     <td>
      PowerShell is a management framework that Microsoft developed to replace Command Prompt and give
          users more power and control over the Windows system. PowerShell is built on the .NET framework and can now be run on
          multiple operating systems including MacOS and Linux.
      <p>
       PowerShell uses cmdlets to execute commands. Cmdlets are tiny scripts that perform certain
          functions. Some cmdlets replace older commands and provide more advanced functions. Users can combine these cmdlets to
          develop scripts to automate tasks and configure just about anything in Windows.
       </p><p>
        Malicious PowerShell scripts pose a major security threat. These scripts can run in the memory of the system which
          means they don't need a executable to run.
        <br>
        </p><ul>
         <li>
          An attacker can take advantage by running malicious PowerShell scripts in the background.
         </li>
         <li>
          This type of malware is known as
          <i class="fs-italicize">
           fileless malware.
          </i>
          Fileless malware is especially dangerous because many anti-virus programs are unable to detect it.
         </li>
        </ul>
       <p></p>
      <p></p>
     </td>
    </tr>
    <tr>
     <td>
      Bash
     </td>
     <td>
      Bash is a command shell and scripting language used in most Linux distros and MacOS versions prior to Catalina.
      <p>
       Bash was released in 1989 and is still heavily used. When a command is executed in Linux, Bash works in the
          background to execute the command using environment variables. Since many web servers run on Linuxâ€™s Apache platform, malware can be designed in Bash to attack these systems.
       </p><p>
        A well-known malware called Shellshock uses Bash commands to exploit a flaw within the Bash shell. The flaw allows an attacker to inject malicious commands.
        </p><p>
        </p>
       <p></p>
      <p></p>
     </td>
    </tr>
   </tbody>
</table>

Malware that exploits shell programs is using the operating system against itself, making this type of malware difficult to detect and prevent.

Keeping anti-malware up to date and training users to not click unknown links or run unknown programs is vital to staying safe.

### Macros

Macros are similar to scripts in that they are little bits of code that are used to perform a series of steps or functions. Macros however are used inside specific applications. Many different programs can make use of macros, but the most common use of macros is in the Microsoft Office programs.

Microsoft Office programs use the Visual Basic for Applications (VBA) programming language to create and run macros. If the Office program is not configured properly, malicious VBA code can be used to open a shell on the Windows operating system. The shell can be used to perform malicious attacks.

In newer version of Microsoft Office, macros are disabled by default and a user must specifically allow them to run.
